\section{Proofs (WIP)}

\subsection{$\hat M \enc \hat N \iff \hat M \leq \hat N$}

We prove the two directions of $\hat M \enc \hat N \iff \hat M \leq \hat N$ separately.

\subsubsection{$\hat M \enc \hat N \implies \hat M \leq \hat N$:} For any $\delta \in \hat I^{+}$, let $\tau \in \hat P^{+}$ and $v \in \hat Q^{+}$ be the induced trajectories $\Driv{\hat M}{\delta}$ and $\Driv{\hat N}{\delta}$, respectively. We first prove that $\tau[k] \enc v[k]$ for each $\delta \in \hat I^{+}$ and $k \in \mathbb{N} : k < | \tau | = | v | = | \delta + 1 |$ by induction on $k$. The base case, $\tau[0] = (\top \in \hat P) \enc \, (\top \in \hat Q) = v[0]$, follows immediately from the definition of $\hat M \enc \hat N$. For the inductive step, assume that $\tau[k] \enc v[k]$. That also $\tau[k+1] = \hat M(\delta[k] \sqcap \tau[k]) \enc \hat N(\delta[k] \sqcap v[k]) = v[k+1]$ follows from the second property of $\tau[k] \enc v[k]$ since $\delta[k] \in \hat I$. Finally, for any $\delta \in \hat I^{+}$, that $\out{\tau[k]} \sqsubseteq \out{v[k]}$ for each $k$ follows from the first property of $\tau[k] \enc v[k]$.

\subsubsection{$\hat M \enc \hat N \Leftarrow \hat M \leq \hat N$:} Define $\enc \in \hat P \times \hat Q$ as follows:

\begin{equation*}
\bigcup_{\delta \in I^{+}} \{ (\Driv{\hat M}{\delta}[k], \Driv{\hat N}{\delta}[k]) \mid k \in \mathbb{N}, k < | \delta + 1 | \}
\end{equation*}

\noindent Here $\Driv{\hat M}{\delta}[k]$ is the k-th predicate of the trajectory induced by $\delta$. By definition of $\enc$, and that $\hat M \leq \hat N$, we thus have that any such pair of k-th predicates must have ordered outputs. That is, for any $\hat p \enc \hat q$, we have that $\out{\hat p} \sqsubseteq \out{\hat q}$. Given that $\hat p = \Driv{\hat M}{\delta}[k]$ and $\Driv{\hat N}{\delta}[k]$ for some common $k$ and $\delta \in \hat I^{+}$, we must also have that $\delta^{\frown}\hat \iota$ ($\delta$ followed by $\hat \iota$) is in $\hat I^{+}$ and thus $\hat M(\hat \iota \sqcap \hat p) = \Driv{\hat M}{\delta^{\frown}\hat \iota}[k+1] \enc \Driv{\hat N}{\delta^{\frown}\hat \iota}[k+1] = \hat N(\hat \iota \sqcap \hat q)$ for all $\hat \iota \in \hat I$. Finally, that $\hat M \enc \hat N$ follows from how $\out{\top \in \hat P} \sqsubseteq \out{\top \in \hat Q}$ is obviously true and that $\langle \hat \iota \rangle \in \hat I^{+}$ for all $\hat \iota \in \hat I$.

\subsection{$\hat M \enc \hat N \implies \forall s \in S : \Phi(s) \enc \Psi(s)$}

Recall that $\hat p \enc \hat q$ implies (1) $\out{\hat p} \sqsubseteq \out{\hat q}$ and (2) $\forall \hat \iota \in \hat I : \hat M(\hat \iota \sqcap \hat p) \enc \hat N(\hat \iota \sqcap \hat q)$.

\begin{align*}
F(s)(\hat p) &= \hat M(\pi_{a}(s) \sqcap \hat p) \\
\mathcal{F}(\Phi)(s) &= \Stmt{if } (s = s_{0}) \Stmt{ then } \top \Stmt{ else } \sqcup \{ F(s')(\Phi(s')) \mid (s',s) \in R \} \\
\Phi_{n} &= \Stmt{if } (n = 0) \Stmt{ then } (\lambda s \in S : \bot) \Stmt{ else } \mathcal{F}(\Phi_{n-1})
\end{align*}

We first prove a few lemmas.

\textbf{Lemma}: $(\bot \in \hat P) \enc \, (\bot \in \hat Q)$. Firstly, $\out{\bot \in \hat P} \sqsubseteq \out{\bot \in \hat Q}$ since any subset (projection) of $\bot$ must be its $\bot$ as well. Secondly, $\hat M$ and $\hat N$ preserves their bottoms, so $\hat M(\hat \iota \sqcap \bot) = \bot = \hat N(\hat \iota \sqcap \bot)$ for all $\hat \iota \in \hat I$.

\textbf{Lemma}: $\hat p \enc \hat q \implies \forall s \in S : F(s)(\hat p) \enc G(s)(\hat q)$. We have $F(s)(\hat p) = \hat M(\pi_{a} \sqcap \hat p)$ and $G(s)(\hat q) = \hat N(\pi_{a}(s) \sqcap \hat q)$, but $\pi_{a}(s) \in \hat I$ so the second property of $\hat p \enc \hat q$ implies that $\hat M(\pi_{a}(s) \sqcap \hat p) \enc \hat N(\pi_{a}(s) \sqcap \hat q)$.

% \textbf{Lemma (3.0.2)}: $\hat M(\hat \iota \sqcap \hat p) \enc \hat N(\hat \iota \sqcap \hat q) \implies \forall \hat p' \in \hat P : \hat p \sqsubseteq \hat p' \implies \hat M(\hat \iota \sqcap \hat p') \enc \hat N(\hat \iota \sqcap \hat q)$.

% \textbf{Lemma}: $\hat p \sqsubseteq \hat p' \implies \out{\hat p} \sqsubseteq \out{\hat p'}$. Follows from the monotonicity of $\out{\cdot}$.

% \textbf{Lemma}: $\hat p \enc \hat q \implies \forall \hat p' \in \hat P : \hat p \sqsubseteq \hat p' \implies \hat p' \enc \hat q$.

\textbf{Lemma}: $(\hat p_{1} \enc \hat q_{1}) \wedge (\hat p_{2} \enc \hat q_{2}) \implies (\hat p_{1} \sqcup \hat p_{2}) \enc \, (\hat q_{1} \sqcup \hat q_{2})$. Let $\hat p = \hat p_{1} \sqcup \hat p_{2}$ such that $\hat p_{1} \sqsubseteq \hat p$, $\hat p_{2} \sqsubseteq \hat p$, and any $\hat x \in \hat P$, if $\hat p_{1} \sqsubseteq \hat x$ or $\hat p_{2} \sqsubseteq \hat x$, then $\hat p \sqsubseteq \hat x$. Similarly, let $\hat q = \hat q_{1} \sqcup \hat q_{2}$. That $\out{\hat p} \sqsubseteq \out{\hat q}$ follows from how $\out{\hat p_{1}} \sqsubseteq \out{\hat q_{1}}$ and $\out{\hat p_{2}} \sqsubseteq \out{\hat q_{2}}$, so both $\out{\hat p_{1}} \sqsubseteq \out{\hat q}$ and $\out{\hat p_{2}} \sqsubseteq \out{\hat q}$, but then we must have by definition of $\hat p$ that $\out{\hat p} \sqsubseteq \out{\hat q}$. Lastly, that $\hat M(\hat \iota \sqcap \hat p) \enc \hat N(\hat \iota \sqcap \hat q)$ for all $\hat \iota \in \hat I$, hmm.

\textbf{Lemma}: $\forall s \in S : \hat p(s) \enc \hat q(s) \implies \sqcup \{ F(s)(\hat p(s)) \mid s \in \: \subseteq S \} \enc \sqcup \{ G(s)(\hat q(s)) \mid s \in \: \subseteq S \}$.

Since $\Phi_{*}(s) = \lim \, \Phi_{n}(s)$ and $\Psi_{*}(s) = \lim \, \Psi_{n}(s)$, it suffices to prove that $\Phi_{n}(s) \enc \Psi_{n}(s)$ for all $s \in S$ and $n \in \mathbb{N}$. We do so by induction on $n$. The base case, where $\Phi_{0}(s) = \bot \in \hat P$ and $\Psi_{0}(s) = \bot \in \hat Q$, follows from lemma X. For the inductive step, assme that $\Phi_{n}(s) \enc \Psi_{n}(s)$ for all $s \in S$. For $s = s_{0}$, we have that $\Phi_{n+1}(s_{0}) = \top \in \hat P$ and $\Psi_{n+1}(s_{0}) = \top \in \hat Q$, which follows from how $\hat M \enc \hat N$ implies that $(\top \in \hat P) \enc \, (\top \in \hat Q)$. For any $s \neq s_{0}$, we have that $\Phi_{n+1}(s) = \mathcal{F}(\Phi_{n})(s) = \sqcup \{ F(s')(\Phi_{n}(s')) \mid (s',s) \in R \}$.

