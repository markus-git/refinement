\section{Appendices}

\subsection{Theorem~\ref{thm:traj-refines}}

We use freely the fact that $[\{ c \}] = [c]$. We first prove a few lemmas.

\begin{lemma} \label{lem:class-sub}
$[d] \cap \Antecedent(\rho) \neq \emptyset \implies [d] \subseteq \Antecedent(\rho)$
\end{lemma}

Since they intersect, there must exist $d' \in [d]$ such that $d' \in \Antecedent(\rho)$. By the invariance of $\Antecedent(\rho)$, it must be that $[d'] = [d] \subseteq \Antecedent(\rho)$. $\qedbox$

\begin{lemma} \label{lem:traj-con}
$d \in \Consequent(\rho) \wedge \{ c \} \ll \{ d \} \implies c \in \gamma(\Consequent(\rho))$
\end{lemma}

By the invariance of $\Consequent$, $d \in \Consequent(\rho)$ implies that $[d] \subseteq \Consequent(\rho)$, which in turn implies $\gamma([d]) \subseteq \gamma(\Consequent(\rho))$ by the monotonicity of $\gamma$. By definition of $\{ c \} \ll \{ d \}$, we know $[c] \subseteq \gamma([d])$, and thus $[c] \subseteq \gamma(\Consequent(\rho))$. That $c \in \gamma(\Consequent(\rho))$ then follows immediately. $\qedbox$

\begin{lemma} \label{lem:traj-ant}
$c \in \gamma(\Antecedent(\rho)) \wedge \{ c \} \ll \{ d \} \implies d \in \Antecedent(\rho)$
\end{lemma}

Given that $c \in \gamma(\Antecedent(\rho))$, there must exists $a \in \Antecedent(\rho)$ such that $\{ c \} \subseteq \gamma(\{ a \})$, or $\alpha(\{ c \}) \subseteq \{ a \}$. By definition of $\{ c \} \ll \{ d \}$, we also have that $[c] \subseteq \gamma([d])$, which implies that $\{ c \} \subseteq \gamma([d])$, or $\alpha(\{ c \}) \subseteq [d]$. Since $\alpha([c]) \neq \emptyset$, it must be that $\{ a \} \cap [d] \neq \emptyset$. We therefore know that $a \in [d]$ and thus $a \sim d$. By the invariance of $\Antecedent$, and that $a \in \Antecedent(\rho)$, it follows that $d \in \Antecedent(\rho)$ as well. $\qedbox$
\\

% By the invariance of $\Antecedent$ and definition of $\gamma(\Antecedent)$, $c \in \gamma(\Antecedent(\rho))$ implies that $[c] \subseteq \gamma(\Antecedent(\rho))$. And thus $\alpha([c]) \subseteq \alpha(\gamma(\Antecedent(\rho)) \subseteq \Antecedent(\rho)$ by the monotonicity of $\alpha$. By definition of $\{ c \} \ll \{ d \}$, we also have that $\alpha([c]) \subseteq [d]$. Since $\alpha([c]) \neq \emptyset$, it must be that $[d] \cap \Antecedent(\rho) \neq \emptyset$, and thus $[d] \subseteq \Antecedent(\rho)$ by lemma~\ref{lem:class-sub}. That $d \in \Antecedent(\rho)$ then follows immediately. $\qedbox$

For the theorem, we are given $\tau \in \Traj(M)$ and $\rho \in \Runs(\gamma(A))$, such that $| \tau | = | \rho |$ and $\tau_{n} \in \gamma(\Antecedent(\rho_{n}))$ for all $n \in \mathbb{N} : n < | \tau |$. We must then show that $\tau_{n} \in \gamma(\Consequent(\rho_{n}))$. By the refinement assumption, there must exist a $\upsilon \in \Traj(N)$ such that $| \tau | = | \upsilon | = | \rho |$ and $\{ \tau_{n} \} \ll \{ \upsilon_{n} \}$. By lemma~\ref{lem:traj-ant}, we know $\upsilon_{n} \in \Antecedent(\rho_{n})$ and thus $\upsilon_{n} \in \Consequent(\rho_{n})$. Lemma~\ref{lem:traj-con} then states that $\tau_{n} \in \gamma(\Consequent(\rho_{n}))$. $\qedbox$

\subsection{Theorem~\ref{thm:traj-equal-set}}

We first show a lemma.

\begin{lemma} \label{lem:ll-sub}
$C \ll D \wedge D \subseteq D' \implies C \ll D'$
\end{lemma}

That $C$ is approximated by $D'$ follows immediately: $\alpha(C) \subseteq D \subseteq D'$. The first property of $\ll$ follows from the definition of subset, and the second by the monotonicity of $N$: $\alpha(M(C)) \subseteq N(D) \subseteq N(D')$. $\qedbox$
\\

We prove each direction of the theorem separately.

$(\Rightarrow)$ : If $C \ll D$, then by definition $\alpha([C]) \subseteq [D]$. As $\alpha$ distributes over arbitrary union, it follows that $\alpha([c]) \subseteq [D]$ for all $c \in C$. We note that every such $c \in C$ is also the start of some trajectories in $M$, and it therefore follows from the refinement assumption that there exist a trajectory in $N$ with a start $d \in \D$ such that $\{ c \} \ll \{ d \}$, or $\alpha([c]) \subseteq [d]$. By the requirement that $\alpha([c]) \neq \emptyset$, it must be that $[d] \cap [D] \neq \emptyset$. By lemma~\ref{lem:class-sub} then, we know $[d] \subseteq [D]$ and thus $d \in D$, which is the first property required of $\ll$. For the second property, that $\ll$ is a simulation relation, consider any ``next-step'' of these trajectories starting in $c$ and $d$, i.e. $c' \in M(\{ c \})$ and $d' \in N(\{ d \})$. From the refinement assumption we know that $\{ c' \} \ll \{ d' \}$, or $\alpha([c']) \subseteq [d'] \subseteq [N(\{ d \})] \subseteq [N(D)]$. Taking the union of every such ordering for $c' \in M(\{ c \})$, we see that $M(\{ c \}) \ll N(D)$ for all $c \in C$, or $M(C) \ll N(D)$, as required.

% there exists a $d' \in N(D)$ such that $\{ c' \} \ll \{ d' \}$, which implies that $\{ c' \} \ll N(D)$ by lemma~\ref{lem:ll-sub}. Combining all such orderings, we have the desired $M(C) \ll N(D)$. $\qedbox$

% i.e. $\alpha([C]) = \cup \{ \alpha([c]) \in \pow(\C) \mid c \in C \}$

$(\Leftarrow)$ : We show this claim by induction on the length of $\tau$. For the base case, $| \tau | = 1$, we are given $\tau = \langle \tau_{1} \rangle$ where $\tau_{1}$ is unconstrained, i.e. we only know that $\tau_{1} \in \C$. But a Galois connection always relates the most general states of its two partially ordered sets, so $\alpha(\{ \C \}) \subseteq \{ \D \}$. As $[\{ \C \}] = \{ \C \}$ and $[\{ \D \}] = \{ \D \}$, we also have $\alpha([\{ \C \}]) \subseteq [\{ \D \}]$, or $\{ \C \} \ll \{ \D \}$. Using the first property of $\ll$ then tells us that there exists $d \in \D$ such that $|\langle \tau_{1} \rangle| = |\langle d \rangle|$ and $\{ \tau_{1} \} \ll \{ d \}$. For the inductive step, $| \tau | = n + 1$, we are given a sequence $\langle \dots, \tau_{n}, \tau_{n+1} \rangle$ and assume there exists another sequence $\langle \dots, \upsilon_{n} \rangle$ such that $|\langle \dots, \tau_{n} \rangle| = |\langle \dots, \upsilon_{n} \rangle|$ and $\langle \dots, \tau_{n} \rangle \ll \langle \dots, \upsilon_{n} \rangle$. From the simulation property of $\ll$, we know that $M(\tau_{n}) \ll N(\upsilon_{n})$ and, by the definition of trajectories, that $\tau_{n+1} \in M(\tau_{n})$. Applying the first property of $\ll$ then states that there exists $d \in N(\upsilon_{n})$ such that $\{ \tau_{n+1} \} \ll \{ d \}$. The concatenation of $\langle \dots, \upsilon_{n+1} \rangle$ and $\langle d \rangle$, i.e. $\langle \dots, \upsilon_{n}, d \rangle$, forms a valid trajectory in $\Traj(N)$ and satisfies the properties $| \langle \dots, \tau_{n}, \tau_{n+1} \rangle | = | \langle \dots, \upsilon_{n}, d \rangle |$ and $\langle \dots, \tau_{n}, \tau_{n+1} \rangle \ll \langle \dots, \upsilon_{n}, d \rangle$. $\qedbox$

% We claim that, for all $\tau \in \Traj(M)$, there exists a $\upsilon \in \Traj(N)$, such that $| \tau | = | \upsilon |$ and $\tau \ll \upsilon$.

\subsection{Theorem~\ref{thm:lat-refines}}

We first show a few lemmas.

\begin{lemma} \label{lem:bot-refine-bot}
$\bot \lll \bot$
\end{lemma}

A Galois connection always relates the two bottoms, $\hat \alpha(\bot) \subseteq \bot$, which implies that $\hat \alpha(\veq{\bot}) \subseteq \veq{\bot}$, or $\bot \lll \bot$, since $\veq{\cdot}$ preserves bottom. As $\hat M$ and $\hat N$ also preserves bottom, it follows that $\hat M(\bot) = \bot \lll \bot = \hat N(\bot)$. $\qedbox$

\begin{lemma} \label{lem:closed-join}
$\hat p \lll \hat q \wedge \hat r \lll \hat s \implies (\hat p \sqcup \hat r) \lll (\hat q \sqcup \hat s)$
\end{lemma}

By definition of $\lll$ and the monotonicity of $\veq{\cdot}$, we both have $\hat \alpha(\veq{\hat p}) \sqsubseteq \veq{\hat q} \sqsubseteq (\veq{\hat q \sqcup \hat s})$ and $\hat \alpha(\veq{\hat r}) \sqsubseteq \veq{\hat s} \sqsubseteq (\veq{\hat q \sqcup \hat s})$. \todo{Because join produces the least upper bound}, it follows that $(\veq{\hat p \sqcup \hat r}) \sqsubseteq \hat \gamma(\veq{\hat q \sqcup \hat s})$, or $(\hat p \sqcup \hat r) \lll (\hat q \sqcup \hat s)$

\begin{lemma} \label{lem:1}
$\dots \implies \forall s \in S : \hat{F}(s)(\hat p) \lll \hat{G}(s)(\hat q)$
\end{lemma}

Text.

\begin{lemma} \label{lem:2}
$\dots \implies \forall s \in S : \hat{\mathcal{F}}(\Phi)(s) \lll \hat{\mathcal{G}}(\Psi)(s)$
\end{lemma}

Text.

\begin{lemma} \label{lem:3}
$\dots \implies \forall s \in S : \Phi_{*}(s) \lll \Psi_{*}(s)$
\end{lemma}

Text.
\\

The theorem asks us to show that $\Phi_{*}(s) \sqcap \hat{\gamma}(\hat{\Antecedent}(s)) \sqsubseteq \hat{\gamma}(\hat{\Consequent}(s))$ for all $s \in S$, assuming that $\Psi_{*}(s) \sqcap \hat{\Antecedent}(s) \sqsubseteq \hat{\Consequent}(s)$. Applying lemma~\ref{lem:3}, we further know that $\Phi_{*}(s) \lll \Psi_{*}(s)$, or $\veq{\Phi_{*}(s)} \sqsubseteq \hat{\gamma}(\veq{\Psi_{*}(s)})$.

\subsection{Theorem~\ref{thm:lat-imply-set}}

Text.
