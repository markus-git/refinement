\section{System refinement (WIP)}

Consider another fixed, but arbitrary, circuit $N$ such that configurations of $M$ and $N$ have the same number of externally visible elements but can differ internally. Let $\hat N \in \hat Q \rightarrow \hat Q$ be an abstract predicate transformer of $N$, we then we say that $\hat M$ \textit{refines} $\hat N$ if every \textit{externally visible behaviour} allowed by $\hat M$ is also allowed by $\hat N$, regardless of any initial configurations.

\textcolor{red}{M always sets it I to $\top$.}

Let the \textit{externally visible} parts of an abstract predicate $\hat P$ be the subsets given by two projections, $\I$ and $\O$, identifying the ``inputs'' and ``outputs'' of $\hat P$, respectively. Further, let $\out{\cdot} \in \hat P \rightarrow \hat O$ be a mapping that takes each $\hat p \in \hat P$ to its visible outputs $\out{\hat p} \in \hat O$; $\out{\cdot}$ is extended to sequences component-wise. With a slight abuse of notation, we overload both projections and the mapping to also accept predicates from $\hat Q$ and note that $\I(\hat P) = \I(\hat Q) = \hat I$ and $\O(\hat P) = \O(\hat Q) = \hat O$.

A \textit{driver} of $\hat M$ and $\hat N$ is a nonempty sequence of inputs, $\delta \in \hat I^{+}$, and induces a trajectory $\tau$ in $\hat M$ (resp. $\hat N$) where $\tau[0] = \delta[0]$ and $\forall i \in \mathbb{N} : 0 < i < | \delta | \implies \tau[j] = \delta[j] \sqcap \hat M(\tau[j-1])$. The set of drivers is denoted by $\Driv$, and the trajectory induced by a driver $\delta$ in $\hat M$ is denoted by $\Traj(\hat M)(\delta)$. Finally, we say that $\hat M$ refines $\hat N$, denoted by $\hat M \leq \hat N$, iff:

\begin{equation*}
\forall \delta \in \hat I^{+} : \out{\Traj(\hat M)(\delta)} \sqsubseteq \out{\Traj(\hat N)(\delta)}
\end{equation*}

\noindent Intuitively, if every possible input sequence produces the same, or at least more specified, outputs, then every visible behaviour of $\hat M$ in covered by $\hat N$.

Let $\enc \in \hat P \times \hat Q$ (``encodes'') be a simulation relation such that $\hat p \enc \hat q$ implies that (1) $\out{\hat p} \sqsubseteq \out{\hat q}$ and (2) $\hat \iota \sqcap \hat M(\hat p) \enc \hat \iota \sqcap \hat N(\hat q)$ for all inputs $\hat \iota \in \hat I$. The relation is extended to transformers such that $\hat M \enc \hat N$ iff all inputs $\hat \iota \in \hat I$ are encoded $\hat \iota \enc \hat \iota$. We then simplify refinement thus: $\hat M \leq \hat N \iff \hat M \enc \hat N$.

\begin{theorem}
Given ...
\end{theorem}

% LocalWords:  consequents
