\section{Introduction to STE}

\subsection{Original STE}

\textit{Symbolic trajectory evaluation}~\cite{seger1995} (STE) is a high-performance model checking technique based on \textit{symbolic simulation} extended with a temporal \textit{next-time} operator to describe circuit behaviour over time. In its simplest form, STE tests the validity of an \textit{assertion} of the form $A \Rightarrow C$, where both the \textit{antecedent} $A$ and \textit{consequent} $C$ are formulas in the following logic:

\begin{equation*}
f ::= p \: | \: f \wedge f \: | \: P \rightarrow f \: | \: \Next f
\end{equation*}

\noindent Here, $p$ is a simple predicate over ``values'' in a circuit and $P$ is a Boolean propositional formula, and the operators $\wedge$, $\rightarrow$ and $\Next$ are conjunction, domain restriction and the next-time operator, respectively.

If the circuit contains Boolean signals, $p$ is typically drawn from the following two predicates: $n \Is 1$ and $n \Is 0$, where $n$ ranges over the signals (or nodes) in a circuit. For example, suppose we have a unit-delayed, two-input AND-gate, then it is reasonable to assume that the assertion $(\mathit{in_{1}} \Is 1 \wedge \mathit{in_{2}} \Is 1) \Rightarrow \Next (\mathit{out} \Is 1)$ is true. Indeed, STE efficiently validates such statements for us.

While the truth semantics of an assertion in STE is defined as the satisfaction of its ``defining'' trajectory (bounded sequence of states) relative to a model structure of the circuit, what the STE algorithm computes is exactly the solution of a data-flow equation~\cite{chou1999} in the classic format~\cite{muchnick1997}. \dots

% translate an STE assertion into a linear, directed graph \dots introducing as many states as the assertion is deep \dots labelling each state with the antecedent and consequent at that depth. \dots

% We adopt this reimagined STE as data flow analysis~\cite{chou1999}, in which trajectory assertions can have arbitrary state-transition graphs. The following sections give a short introduction to its mathematical foundation.

\subsection{Lattice-theoretic STE}

Consider an arbitrary, but fixed, digital circuit $M$ operating in discrete time. A \textit{configuration} of $M$, denoted by $C$, is non-empty and finite set that represents a snapshot of $M$ at a discrete point in time. If the circuit $M$ has $m$ boolean signals, then its set of configurations is typically represented as a sequence $\mathbb{B}^{m}$, where $\mathbb{B} = \{ 0,1 \}$ is the set of boolean values.

\subsubsection{Circuit Model} A simple conceptual model of $M$ is a \textit{transition relation}, $M_{R} \subseteq C \times C$, where $(c,c') \in M_{R}$ means that $M$ can move from $c$ to $c'$ in one step\footnotemark. The power set of $C$, denoted by $\mathcal{P}(C)$, can be viewed as a the set of \textit{predicates} on configurations, where $\cap$, $\cup$, and $\subseteq$ correspond to conjunction, disjunction and implication, respectively. Furthermore, for any $Q \subseteq \mathcal{P}(C)$, we denote by $\cap Q$ and $\cup Q$ the intersection and union of all members of $Q$.

\footnotetext{\todo{Mention how this affects circuits with zero-delays?}}

$M_{R}$ induces a \textit{predicate transformer} $M_{F} \in \mathcal{P}(C) \rightarrow \mathcal{P}(C)$ using the relational image operation:

\begin{equation*}
M_{F}(p) = \{ c' \in C \mid \exists c \in p : (c,c') \in M_{R} \}
\end{equation*}

\noindent It is intuitively obvious that if $M$ is in one of the configurations in $p \in \mathcal{P}(C)$, then in one time step it must be in one of the configurations in $M_{F}(p)$. Furthermore, from its definition we see that $M_{F}$ distributes over arbitrary unions:

\begin{equation*}
M_{F}(\cup Q) = \cup \{ M_{F}(q) \mid q \in Q \}
\end{equation*}

\noindent for all $Q \subseteq \mathcal{P}(C)$. Any $M_{F}$ that satisfies this distributive property also defines a $M_{R}$ through the equivalence $(c,c') \in M_{R} \iff c' \in M_{F}(\{ c \})$, that is to say, there is no loss of information going from $M_{R}$ to $M_{F}$ or vice versa. We adopt this functional model of $M$ and drop its subscript. It follows its distributivity that $M$ also preserves the empty set of constraints, i.e. $M(\emptyset) = \emptyset$, and that $M$ is monotonic, i.e. $p \subseteq q \implies M(p) \subseteq M(q)$ for all $p, q \in \mathcal{P}(C)$.

In practice, signals in $M$ are typically divided into ``input'' signals and ``output'' or ``internal'' signals. While an input signal is typically controlled by the external environment, and thus unconstrained by $M$ itself, non-input signals are determined by the circuit topology and functionality. For example, supposed $M$ is the earlier example of a unit-delayed two-input AND gate, we could then define its model $\mathcal{M} \in \mathcal{P}(\mathbb{B}^{3}) \rightarrow \mathcal{P}(\mathbb{B}^{3})$ as:

% although not required here

\begin{equation*}
\mathcal{M}(p) = \{ \langle b_{1}, b_{2}, i_{1} \wedge i_{2} \rangle \in \mathbb{B}^{3} \mid \langle i_{1}, i_{2}, o \rangle \in p \}
\end{equation*}

\noindent Here $i_{1}$ and $i_{2}$ refer to the two inputs of the AND gate and $o$ the ignored output; $b_{1}$ and $b_{2}$ are unconstrained inputs in the new configuration.

\subsubsection{Ternary lattices}

Manipulating subsets of $\mathbb{B}^{m}$ is however impractical for even moderately large $m$, which leads us to one of the key insights of STE. Namely, instead of manipulating subsets of $\mathbb{B}^{m}$ directly, one can use sequences of ternary values $\mathbb{T} = \mathbb{B} \cup \{ \X \} $ to approximate them, whose sizes are only linear in $m$. Here the $1$ and $0$ from $\mathbb{B}$ denotes specific, defined values whereas $\X$ denotes an ``unknown'' value that could be either $1$ or $0$. This intuition induces a partial order $\sqsubseteq$ on $\mathbb{T}$, where $0 \sqsubseteq \X$ and $1 \sqsubseteq \X$\footnotemark. For any $m \in \mathbb{N}$, this ordering on $\mathbb{T}$ is lifted component-wise to $\mathbb{T}^{m}$.

% As an example, we have that $\langle 1,1,0 \rangle$ and $\langle 1,0,0 \rangle$ are both $\sqsubseteq \langle 1,X,0 \rangle \in \mathbb{T}^{3}$ because they all agree on their first and third element and $X$ can be both $0$ and $1$.

\footnotetext{We use the reverse ordering of what is originally used in STE.}

Note that $\mathbb{T}^{m}$ does not quite form a complete lattice because it lacks a bottom: both $0 \sqsubseteq \X$ and $1 \sqsubseteq \X$ but $0$ and $1$ are equally defined. A special bottom element $\bot$ is therefore introduced, such that $\bot \sqsubseteq t$ and $\bot \neq t$ for all $t \in \mathbb{T}^{m}$. The extended $\mathbb{T}_{\bot}^{m} = \mathbb{T}^{m} \cup \{ \bot \}$ then becomes a complete lattice. We denote the top element $\langle \X, \dots, \X \rangle$ of $\mathbb{T}_{\bot}^{m}$ by $\top$.

Generalising from any specific domain, let $(\hat P,\sqsubseteq)$ be a finite, complete lattice of \textit{abstract predicates} in which the meet $\sqcap$ and join $\sqcup$ of any subset $Q \subseteq \hat P$ exists. Similar to the previous set operations for power sets, $\sqcap$, $\sqcup$ and $\sqsubseteq$ correspond to conjunction, disjunction and implication for abstract predicates, respectively. Furthermore, for any $Q \subseteq \hat P$, we denote by $\sqcap Q$ and $\sqcup Q$ the meet and join of all members of $Q$.

\subsubsection{Abstract circuit model}

Let there be Galois connection $\ll \: \in \left. \subseteq \mathcal{P}(C) \times \hat P \right.$ relating concrete and abstract predicates, where $p \ll \hat p$ reads as ``$p$ can be approximated as $\hat p$'' and for all $Q \subseteq \mathcal{P}(C)$ and $\hat Q \subseteq \hat P$:

\begin{equation*}
Q \ll \hat Q \iff \cup Q \ll \sqcap \hat Q
\end{equation*}

\noindent where $Q \ll \hat Q \iff \forall p \in Q : \forall \hat p \in \hat Q : p \ll \hat p$. In other words, $\ll$ is an extension of the partial order $\subseteq$ of $\mathcal{P}(C)$ and $\sqsubseteq$ of $\hat P$ to an ordering between $\mathcal{P}(C)$ and $\hat P$. As an illustration of this property, consider how we must have that $\{ \langle 1,1,0 \rangle, \langle 1,0,0 \rangle \} \in \mathbb{B}^{3} \ll \{ \langle 1, \X, 0  \rangle \} \in \mathbb{T}_{\bot}^{3}$ for the ternary abstraction.

It is sometimes convenient, or more intuitive, to define a Galois connection in terms of an \textit{abstraction} $\alpha \in \mathcal{P}(C) \rightarrow \hat P$ and a \textit{concretisation} $\gamma \in \hat P \rightarrow \mathcal{P}(C)$ function, from which we can derive $\ll$ as $p \ll \hat p \iff p \subseteq \gamma(\hat p)$ or $p \ll \hat p \iff \alpha (p) \sqsubseteq \hat p$. For example, a Galois connection from $\mathcal{P}(\mathbb{B}^{m})$ to $\mathbb{T}_{\bot}^{m}$ for any $m \in \mathbb{N}$ can be defined in a natural way by specifying its concretisation $\Gamma \in \mathbb{T}_{\bot}^{m} \rightarrow \mathcal{P}(\mathbb{B}^{m})$ as:

\begin{align*}
\Gamma ( \langle t_{0},\dots,t_{m-1} \rangle ) &= \{ \langle b_{0},\dots,b_{m-1} \rangle \in \mathbb{B}^{m} \mid \forall i < m : t_{i} \neq \X \Rightarrow b_{i} = t_{i} \} \\
\Gamma ( \bot ) &= \emptyset
\end{align*}

\noindent Listing each boolean sequence approximated by $\langle 1, \X, 0 \rangle \in \mathbb{T}_{\bot}^{3}$, we get the sequence $\{ \langle 1, 1, 0 \rangle, \langle 1, 0, 0 \rangle \} \in \mathbb{B}^{3}$ as desired.

% , reaffirming the $\ll$ relation between these sequences.

An \textit{abstract predicate transformer} $\hat M \in \hat P \rightarrow \hat P$ is an \textit{abstract interpretation}~\cite{cousot1996} of $M \in \mathcal{P}(C) \rightarrow \mathcal{P}(C)$ iff: (1) $\hat M$ preserves $\bot$, i.e. $\hat M(\bot) = \bot$; (2) $\hat M$ is monotonic, i.e. $\hat p \sqsubseteq \hat q \Rightarrow \hat M (\hat p) \sqsubseteq \hat M (\hat q)$ for all $\hat p, \hat q \in \hat P$; and (3) $\ll$ is a \textit{simulation relation} from $\mathcal{P}(C)$ to $\hat P$, i.e. $p \ll \hat p \Rightarrow M (p) \ll \hat M (\hat p)$ for all $p \in \mathcal{P}(C)$ and $\hat p \in \hat P$. That $\ll$ is a simulation relation can also be stated in terms of its abstraction $\alpha$ and concretisation $\gamma$ functions: $\alpha(M(p)) \sqsubseteq \hat M(\alpha(p))$ for all $p \in \mathcal{P}(C)$, and $M(\gamma(\hat p)) \subseteq \gamma(\hat M(\hat p))$ for all $\hat p \in \hat P$.

Note that $\hat M$, in general, does not distribute over arbitrary union. Intuitively, information is potentially thrown away by the join operation for $\hat M$ that would have been kept by union in the original model $M$. As an example, we define $\hat{\mathcal{M}}$ as an abstract interpretation for the earlier $\mathcal{M}$:

\begin{align*}
\hat{\mathcal{M}}(\langle p_{1}, p_{2}, p_{3} \rangle) &=
\left\{
  \begin{array}{ll}
    \langle \X, \X, 1 \rangle, & \textrm{if } p_{1} = 1 \textrm{ and } p_{2} = 1 \\
    \langle \X, \X, 0 \rangle, & \textrm{if } p_{1} = 0 \textrm{ or } p_{2} = 0 \\
    \langle \X, \X, \X \rangle, & \textrm{otherwise}
  \end{array}
\right. \\
\hat{\mathcal{M}}(\bot) &= \bot
\end{align*}

\noindent If we apply $\hat{\mathcal{M}}$ to the join of $\langle 0, 1, \X \rangle$ and $\langle 1, 0, \X \rangle$, or if we apply $\hat{\mathcal{M}}$ to them individually and then join the results, we get two different results:

\begin{equation*}
\begin{array}{lll}
  \hat{\mathcal{M}}(\langle 0, 1, \X \rangle \sqcup \langle 1, 0, \X \rangle) &= \hat{\mathcal{M}}(\langle \X, \X, \X \rangle) &= \langle \X, \X, \X \rangle \\
  \hat{\mathcal{M}}(\langle 0, 1, \X \rangle) \sqcup \hat{\mathcal{M}}(\langle 1, 0, \X \rangle) &= \langle \X, \X, 0 \rangle \sqcup \langle \X, \X, 0 \rangle &= \langle \X, \X, 0 \rangle
\end{array}
\end{equation*}

\noindent The inequality $\sqcup \{ \hat M(\hat q) \mid \hat q \in \hat Q \} \sqsubseteq \hat M(\sqcup \hat Q)$ for all $\hat Q \sqsubseteq \hat P$ does however hold, since it is implied by the monotonicity of $\hat M$.

\subsubsection{Assertions and satisfaction}

A \textit{trajectory assertion} for $\hat M$ is a quintuple $\hat A = (S,s_{0},R,\pi_{a},\pi_{c})$, where $S$ is a finite set of \textit{states}, $s_{0} \in S$ is an \textit{initial state}, $R \subseteq S \times S$ is a \textit{transition relation}, $\pi_{a} \in S \rightarrow \hat P$ and $\pi_{c} \in S \rightarrow \hat P$ label each state $s$ with an \textit{antecedent} $\pi_{a}(s)$ and a \textit{consequent} $\pi_{c}(s)$. Furthermore, we assume that $(s,s_{0}) \notin S$ for all $s \in S$ without any loss of generality.

For all $\Phi \in S \rightarrow \hat P$ and $s \in S$, define $F \in S \rightarrow (\hat P \rightarrow \hat P)$ and $\mathcal{F} \in (S \rightarrow \hat P) \rightarrow (S \rightarrow \hat P)$ as follows:

\begin{align}
F(s)(\hat p) &= \hat M(\pi_{a}(s) \sqcap \hat p) \\
\mathcal{F}(\Phi)(s) &= \Stmt{if } (s = s_{0}) \Stmt{ then } \top \Stmt{ else } \sqcup \{ F(s')(\Phi(s')) \mid (s',s) \in R \}
\end{align}

\noindent $F$ preserves $\bot$ and both $F$ and $\mathcal{F}$ are monotonic, where two $\Phi, \Phi' \in S \rightarrow \hat P$ are ordered as $\Phi \sqsubseteq \Phi' \iff \forall s \in S : \Phi(s) \sqsubseteq \Phi'(s)$. Let $\Phi_{*} \in S \rightarrow \hat P$ be the least fixpoint of the equation $\Phi = \mathcal{F}(\Phi)$~\cite{davey2002}. Since both $S$ and $\hat P$ are finite, $\Phi_{*}$ is given by $\lim \, \Phi_{n}(s)$ where $\Phi_{n}$ is defined as follows:

\begin{equation}
\Phi_{n} = \Stmt{if } (n = 0) \Stmt{ then } (\lambda s \in S : \bot) \Stmt{ else } \mathcal{F}(\Phi_{n-1})
\end{equation}

We say that the abstract circuit $\hat M$ \textit{satisfies} a lattice-based, abstract trajectory assertion $\hat A$, denoted by $\hat M \models \hat A$, iff:

\begin{equation}
\forall s \in S : \Phi_{*}(s) \sqcap \pi_{\alpha}(s) \sqsubseteq \pi_{c}(s)
\end{equation}

\noindent $\hat M \models \hat A$ implies that a concretisation of $\hat A$ can also be satisfied by the original, set-based model $M$ \cite{chou1999}.
